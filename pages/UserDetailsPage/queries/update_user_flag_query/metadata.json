{
  "gitSyncId": "68b57ee1db221e2c35e689c6_d6b5e3ef-713c-4445-88cc-37e3146c853b",
  "id": "UserDetailsPage_update_user_flag_query",
  "pluginId": "oracle-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "encodeParamsToggle": true,
      "formData": {
        "body": {
          "data": "DECLARE\n  v_exists   NUMBER := 0;\n  v_changes  NUMBER := 0;\nBEGIN\n  -- check if user exists\n  SELECT COUNT(*)\n  INTO v_exists\n  FROM COREAPPS.APP_USERS\n  WHERE SUBS_ID = {{this.params.subsId}};\n\n  -- only execute dynamic SQL if valid update was passed\n  IF v_exists > 0 AND LENGTH(TRIM('{{this.params.appUsersSql}}')) > 0 THEN\n    EXECUTE IMMEDIATE '{{this.params.appUsersSql}}';\n    v_changes := v_changes + SQL%ROWCOUNT;\n  END IF;\n\n  -- update dependents_phone\n  UPDATE COREAPPS.DEPENDENTS_PHONE\n     SET PHONE_NUMBER = '{{this.params.dependentPhone}}',\n         CREATED_DATE = SYSDATE\n   WHERE SUBS_ID = {{this.params.subsId}};\n  v_changes := v_changes + SQL%ROWCOUNT;\n\n  -- insert if no update happened\n  IF SQL%ROWCOUNT = 0 THEN\n    INSERT INTO COREAPPS.DEPENDENTS_PHONE (\n      ID, SUBS_ID, HOF_ID, PHONE_NUMBER, CREATED_DATE, FLG_ENABLE\n    ) VALUES (\n      DEPENDENTS_PHONE_SEQ.NEXTVAL,\n      {{this.params.subsId}},\n      {{this.params.hofId}},\n      '{{this.params.dependentPhone}}',\n      SYSDATE,\n      1\n    );\n    v_changes := v_changes + 1;\n  END IF;\n\n  -- safety check\n  IF v_changes = 0 THEN\n    RAISE_APPLICATION_ERROR(-20001, 'No rows updated or inserted.');\n  END IF;\n\n  COMMIT;\nEND;\n"
        },
        "preparedStatement": {
          "data": false
        }
      },
      "paginationType": "NONE",
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "medexa",
      "isAutoGenerated": false,
      "name": "medexa",
      "pluginId": "oracle-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "formData.body.data"
      }
    ],
    "name": "update_user_flag_query",
    "pageId": "UserDetailsPage",
    "runBehaviour": "MANUAL",
    "userSetOnLoad": false
  }
}